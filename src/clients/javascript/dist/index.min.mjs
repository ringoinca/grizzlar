class t{constructor(t,e,s,o){if(this.status=i.IDLE,!t)throw new Error("Couldn't connect. Missing argument: integration (string)");if(!window)throw new Error("Couldn't connect. The window object is undefined. Are you using connect from a browser?");this.integration=t,this.options=e,this.key=s,this.origin=o}trigger(){const t=this.toQueryString(this.key,this.options),s=new URL("/auth/"+this.integration+(t?"?"+t:""),this.origin).href;return new Promise((t,o)=>{const n=e=>{if(this.status!==i.BUSY)return;if(e&&new URL(e.origin).origin!==new URL(this.origin).origin)return;if(this.status=i.DONE,!e){return o(new Error("Authorization cancelled. The user has likely interrupted the process by closing the modal."))}if(!e.data||!e.data.eventType){return o(new Error("Authorization failed. The authorization modal sent an unsupported MessageEvent."))}const{data:s}=e;return"AUTHORIZATION_SUCEEDED"===s.eventType?t(s.data):"AUTHORIZATION_FAILED"===s.eventType?o(s.data):void o(new Error("Authorization failed. Thatâ€™s all we know."))};window.addEventListener("message",n,!1),this.status=i.BUSY;const r=new e(s);r.open(),r.addEventListener("close",n)})}toQueryString(t,i){let e=[];if(t&&"string"==typeof t&&e.push("pizzly_pkey="+t),i&&"string"==typeof i.authId&&e.push("authId="+i.authId),i&&"string"==typeof i.setupId&&e.push("setupId="+i.setupId),i&&void 0!==i.params)for(const t in i.params){const s=i.params[t];"string"==typeof s&&e.push(`params[${t}]=${s}`)}return e.join("&")}}var i;!function(t){t[t.IDLE=0]="IDLE",t[t.BUSY=1]="BUSY",t[t.DONE=2]="DONE"}(i||(i={}));class e{constructor(t){this.width=500,this.height=600,this.url=t;const{left:i,top:e,computedWidth:s,computedHeight:o}=this.layout(this.width,this.height);this.features={width:s,height:o,top:e,left:i,scrollbars:"yes",resizable:"yes",status:"no",toolbar:"no",location:"no",copyhistory:"no",menubar:"no",directories:"no"}}layout(t,i){const e=window.screen.width,s=window.screen.height,o=e/2-t/2,n=s/2-i/2,r=Math.min(t,e),h=Math.min(i,s);return{left:Math.max(o,0),top:Math.max(n,0),computedWidth:r,computedHeight:h}}open(){const t=this.url,i=this.featuresToString();return this.modal=window.open(t,"",i),this.modal}addEventListener(t,i){if("close"!==t)return;if(!this.modal)return void i();const e=window.setInterval(()=>{this.modal&&!this.modal.closed||(i(),window.clearInterval(e))},100)}featuresToString(){const t=this.features,i=[];for(let e in t)i.push(e+"="+t[e]);return i.join(",")}}class s{constructor(t,i,e,o){this.options={},this.auth=t=>new s(this.integration,Object.assign(Object.assign({},this.options),{authId:t}),this.key,this.origin),this.setup=t=>new s(this.integration,Object.assign(Object.assign({},this.options),{setupId:t}),this.key,this.origin),this.get=(t,i)=>this.request("GET",t,i),this.head=(t,i)=>this.request("HEAD",t,i),this.post=(t,i)=>this.request("POST",t,i),this.put=(t,i)=>this.request("PUT",t,i),this.delete=(t,i)=>this.request("DELETE",t,i),this.patch=(t,i)=>this.request("PATCH",t,i),this.request=(t,i,e={})=>{if(e&&"object"!=typeof e)throw new Error('Unable to trigger API request. Request parameters should be an object in the form "{ headers: { "Foo": "bar" }, body: "My body" }');const s={"Pizzly-Auth-Id":this.options.authId,"Pizzly-Setup-Id":this.options.setupId};if(e&&e.headers)for(const t in e.headers)s["Pizzly-Proxy-"+t]=e.headers[t];const o=this.toURL(this.origin,"/proxy/"+this.integration,i,this.key,e.query);return(0,window.fetch)(o.toString(),{method:t,headers:this.cleanHeaders(s),body:e&&e.body})},this.integration=t,this.options=i,this.origin=o,this.key=e}connect(i){const e=Object.assign(Object.assign({},this.options),i||{});return new t(this.integration,e,this.key,this.origin).trigger()}toURL(t,i,e,s,o){const n=t=>t.replace(/^\//,""),r=t=>t.replace(/\/$/,""),h=[];h.push(r(t)),h.push(n(r(i))),h.push(n(e));const a=new URL(h.join("/"));return s&&a.searchParams.append("pizzly_pkey",s),o&&Object.keys(o).forEach(t=>a.searchParams.append(t,String(o[t]))),a}cleanHeaders(t){return Object.keys(t).reduce((i,e)=>(void 0!==t[e]&&(i[e]=t[e]),i),{})}}export default class{constructor(t,i){if(this.key="",this.origin="",!window){throw new Error("Couldn't initialize Pizzly. The window object is undefined. Are you using Pizzly from a browser?")}if(t&&"string"==typeof t&&(this.key=t),i&&"string"==typeof i)this.origin=new URL(i).href;else if(i&&"object"==typeof i){const t=i.protocol||window.location.protocol,e=i.port||window.location.port||80,s=i.hostname||window.location.hostname;this.origin=new URL(t+"//"+s+":"+e).href}if(!this.origin){const i="object"==typeof t&&t.host;if(i)if(i.startsWith("http://")||i.startsWith("https://"))this.origin=new URL(i).href;else{const t=window.location.protocol;this.origin=new URL(t+"//"+i).href}else{const t=window.location.protocol,i=window.location.hostname,e=window.location.port||80,s=i+(80!==Number(e)?":"+e:"");this.origin=new URL(t+"//"+s).href}}if(!this.key){const i="object"==typeof t&&t.publishableKey;i&&(this.key=i)}return this}connect(i,e){return new t(i,e||{},this.key,this.origin).trigger()}integration(t,i){return new s(t,i||{},this.key,this.origin)}}